# 英才ブログ生成ツール - 技術仕様書

## 概要

英才個別学院のブログ記事を自動生成するTampermonkeyユーザースクリプト。Google Gemini（https://gemini.google.com/*）で動作し、教室情報の管理、ブログ記事の生成、サムネイル画像のプロンプト作成を行う。

## システム要件

- **ブラウザ**: Chrome, Firefox, Edge, Safari などTampermonkeyをサポートするブラウザ
- **拡張機能**: Tampermonkey
- **対象サイト**: https://gemini.google.com/*
- **ストレージ**: TampermonkeyのGM_setValue/GM_getValue（永続ストレージ）

## アーキテクチャ

### 主要コンポーネント

1. **設定管理モジュール**
   - バージョン管理ストレージ（STORAGE_KEY）
   - 教室情報永続ストレージ（CLASSROOM_STORAGE_KEY）
   - 設定の保存・復元機能

2. **UI生成モジュール**
   - パネルインターフェースの動的生成
   - フォーム要素の作成とイベント管理
   - トグルスイッチ、ボタン、セレクトボックス等

3. **ブログ生成モジュール**
   - 記事タイプ別のプロンプト生成
   - テンプレート管理
   - HTMLコンテンツの生成

4. **画像生成モジュール**
   - NANO BANANA PRO対応のプロンプト作成
   - 人物紹介タイプ専用のサムネイル生成
   - カラースタイルとビジュアルスタイルの適用

### データ構造

#### 設定データ構造
```javascript
{
  // バージョン管理データ
  version: "0.56.60",
  classroomName: "",
  managerName: "",
  classroomUrl: "",
  classroomTel: "",
  
  // 教室情報（永続）
  name: "",
  manager: "",
  url: "",
  tel: ""
}
```

#### 記事タイプ定義
```javascript
const BLOG_TYPES = {
  BASIC: 'basic',           // 基本ブログ
  CAMPAIGN: 'campaign',     // キャンペーン
  EVENT: 'event',          // イベント
  COLUMN: 'column',        // コラム
  INTERVIEW: 'interview',  // インタビュー
  PERSON: 'person'         // 人物紹介
};
```

## 主要機能

### 1. 教室情報管理
- **入力項目**: 教室名、責任者名、URL、電話番号
- **永続化**: CLASSROOM_STORAGE_KEYに保存
- **自動復元**: パネル初期化時に自動復元
- **バリデーション**: URL形式のチェック

### 2. ブログ記事生成

#### 基本ブログ
- 生徒の成功事例
- 学習効果の具体的な記述
- 保護者向けの安心感演出

#### キャンペーンブログ
- 期間限定の特典
- お問い合わせ数の目標設定
- 緊急性の演出

#### イベントブログ
- イベントの詳細情報
- 参加対象と募集人数
- 開催場所と時間

#### コラムブログ
- 専門的な教育内容
- 保護者向けのアドバイス
- 具体的な学習方法

#### インタビューブログ
- 卒業生の成功事例
- 大学合格の経験談
- 具体的な成長過程

#### 人物紹介ブログ
- 講師の経歴と専門性
- 指導方針と特徴
- 生徒からの信頼性

### 3. サムネイル生成

#### 人物紹介タイプの特殊処理
- **ベース画像**: アップロードされた先生の写真
- **背景**: 透過背景＋おしゃれなグラフィック背景
- **レイアウト**: 右1/3に先生（バストアップ）、左2/3にテキストエリア
- **名前表示**: 日本語フルネーム＋ローマ字フルネーム（2行）

#### カラースタイル
- メインカラーとサブカラーの選択
- お任せモード（訴求スタイルに応じて自動選択）
- グラデーション効果の適用

#### ビジュアルスタイル
- 実写スタイル
- アニメスタイル
- イラストスタイル
- 3Dスタイル

## 保存データ

### ストレージキー
- `STORAGE_KEY`: `eisai_blog_info_v05660`（バージョン依存）
- `CLASSROOM_STORAGE_KEY`: `eisai_classroom_settings_persistent`（永続）

### 保存される情報
- 教室名、責任者名、URL、電話番号
- 最後に使用した設定値
- バージョン情報

## バージョン管理

### バージョン形式
- セマンティックバージョニング: `0.56.59`
- 主要コンポーネントの同期:
  - `@version`
  - `TOOL_ID`
  - `BTN_ID`
  - `STORAGE_KEY`
  - `CURRENT_VERSION`

### 更新ルール
1. **コード変更時**: 必ずバージョンをインクリメント
2. **Gitコミット**: バージョン更新と同時に実行
3. **GitHubプッシュ**: コミット後に必ず実行
4. **Tampermonkey同期**: ローカル版もバージョン合わせ

## セキュリティ

### データ保護
- Tampermonkeyスコープ内でのみデータ保存
- 外部APIへの送信なし
- ユーザーデータのローカル保持

### 入力検証
- URL形式のバリデーション
- 必須項目のチェック
- XSS対策のエスケープ処理

## 互換性

### ブラウザ対応
- Chrome 88+
- Firefox 85+
- Edge 88+
- Safari 14+

### Tampermonkeyバージョン
- 4.11以上を推奨
- GM_setValue/GM_getValue API必須

## パフォーマンス

### 最適化
- 遅延読み込み
- イベント委譲
- メモリリーク防止

### 制限事項
- GeminiのAPI制限に依存
- 大量データの一括処理は非推奨

## 拡張性

### 追加機能の実装方法
1. BLOG_TYPES定数に新しいタイプを追加
2. generatePrompt()にケースを追加
3. テンプレートを定義
4. UIに選択肢を追加

### カスタマイズポイント
- カラースキームの追加
- 新しい記事タイプの定義
- プロンプトテンプレートの修正

## トラブルシューティング

### 既知の問題
1. 教室情報の保存失敗 → CLASSROOM_STORAGE_KEYの確認
2. サムネイル生成の不具合 → 人物紹介タイプの条件分岐を確認
3. バージョン不一致 → 全コンポーネントのバージョンを同期

### デバッグ方法
- コンソールログの確認
- ストレージデータの検証
- Gemini APIの応答確認
